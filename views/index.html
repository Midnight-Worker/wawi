<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>EAN-Scanner Desktop</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        async function lookup() {
            const ean = document.getElementById("ean").value.trim();
            if (!ean) {
                alert("Bitte EAN eingeben.");
                return;
            }
            try {
                const result = await window.pywebview.api.lookup_ean(ean);
                renderResult(result);
            } catch (e) {
                console.error(e);
                alert("Fehler bei lookup_ean.");
            }
        }

        async function saveManual() {
            const ean = document.getElementById("ean").value.trim();
            const name = document.getElementById("name").value.trim();
            const brand = document.getElementById("brand").value.trim();
            if (!ean || !name) {
                alert("EAN und Name sind Pflicht.");
                return;
            }
            try {
                const res = await window.pywebview.api.save_product(ean, name, brand);
                alert(res.message);
            } catch (e) {
                console.error(e);
                alert("Fehler beim Speichern.");
            }
        }

        function renderResult(data) {
            document.getElementById("result").textContent = JSON.stringify(data, null, 2);

            if (data.name) {
                document.getElementById("name").value = data.name;
            }
            if (data.brand) {
                document.getElementById("brand").value = data.brand;
            }

            const img = document.getElementById("product-image");
            if (data.image_path) {
                // pywebview l√§dt lokal, daher file://-Pfad
                img.src = "file://" + data.image_path;
                img.style.display = "block";
            } else {
                img.src = "";
                img.style.display = "none";
            }
        }
    </script>
</head>
<body>
    <h1>EAN-Scanner Desktop (pywebview)</h1>

    <label>EAN:
        <input id="ean" type="text" placeholder="EAN">
    </label>
    <button onclick="lookup()">Lookup</button>

    <h2>Produktdaten</h2>
    <label>Name:
        <input id="name" type="text" size="40">
    </label>
    <br>
    <label>Marke:
        <input id="brand" type="text" size="40">
    </label>
    <br>
    <button onclick="saveManual()">Manuell speichern</button>

    <h2>Bild</h2>
    <img id="product-image" alt="Produktbild" style="max-width: 300px; display: none;">

    <h2>Rohdaten</h2>
    <pre id="result"></pre>
</body>
</html>
